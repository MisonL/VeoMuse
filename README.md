# VeoMuse

VeoMuse是一个基于Gemini Veo模型的文字/图片生成视频的应用程序。用户可以通过简单的Web界面输入文字描述或上传图片，应用程序会调用Gemini Veo模型生成相应的视频。

## 重要说明

**注意：Gemini Veo模型目前仅在付费层级可用，免费层级的API密钥无法使用此功能。您需要一个有效的付费API密钥才能生成视频。**

## 功能特点

- 文字生成视频：输入文字描述，自动生成相关视频内容
- 图片生成视频：上传图片，生成基于图片的视频内容
- 负面提示支持：指定不希望在视频中出现的内容
- 多API密钥支持：支持配置多个API密钥，自动轮转
- 临时API密钥：支持在Web界面临时输入API密钥（非持久化）
- 视频在线预览：生成完成后可直接在浏览器中预览视频
- 视频转码功能：支持多种格式（MP4、WebM、MOV）和分辨率选择
- 图片点击预览：上传的图片可点击查看大图
- 现代化的响应式Web界面
- 深色/浅色主题切换
- 视频下载功能
- 实时生成状态显示
- 简单易用的操作流程
- GPU加速视频处理（支持NVIDIA、Intel、AMD）
- 自动生成的提示词优化
- 视频生成历史记录

## 技术栈

- 后端：Node.js + Express
- 前端：HTML5 + CSS3 + JavaScript
- 文件处理：Multer
- HTTP客户端：Axios
- 视频生成：集成Gemini Veo模型API
- 视频处理：FFmpeg + GPU加速
- 实时通信：Socket.IO
- 缓存：Redis（可选）

## 安装和运行

1. 克隆项目到本地：
   ```
   git clone <项目地址>
   cd VeoMuse
   ```

2. 安装依赖：
   ```
   npm install
   ```

3. 配置环境变量：
   ```
   cp .env.example .env
   ```
   然后编辑 `.env` 文件，填入您的Gemini API密钥

4. 启动服务器：
   ```
   npm start
   ```
   或者在开发模式下运行：
   ```
   npm run dev
   ```

5. 在浏览器中访问 `http://localhost:3000`

## 目录结构

```
VeoMuse/
├── server.js          # 服务器主文件
├── config.js         # 应用配置文件
├── package.json       # 项目配置文件
├── .env.example       # 环境变量示例文件
├── .env               # 环境变量配置文件
├── public/            # 静态文件目录
│   └── index.html     # 主页面
├── uploads/           # 上传文件目录
├── generated/         # 生成的视频文件目录
├── tests/             # 测试文件目录
├── API_DOCUMENTATION.md # API文档
└── README.md          # 项目说明文件
```

## 使用说明

### API密钥配置

**重要：Gemini Veo模型目前仅在付费层级可用，免费层级的API密钥无法使用此功能。**

1. **临时API密钥**：在Web界面的顶部输入框中输入API密钥，仅在当前会话中有效
2. **持久化API密钥**：
   - 在 `.env` 文件中设置 `GEMINI_API_KEYS`（逗号分隔多个密钥）
   - 当一个密钥的配额用完时，系统会自动轮转到下一个密钥

### 文字生成视频

1. 在"文字生成视频"选项卡中输入详细的文字描述
2. （可选）在负面提示中添加不希望出现的内容描述
3. 点击"生成视频"按钮
4. 等待视频生成完成，可在页面中直接预览

### 图片生成视频

1. 切换到"图片生成视频"选项卡
2. 点击"选择文件"上传一张图片
3. 在图片描述中添加关于如何基于图片生成视频的详细提示
4. （可选）在负面提示中添加不希望出现的内容描述
5. 点击"生成视频"按钮
6. 等待视频生成完成，可在页面中直接预览

### 视频处理

1. 生成完成后，可选择不同的视频格式（MP4、WebM、MOV）
2. 可选择不同的分辨率（720p、1080p）
3. 点击"转码视频"按钮进行转码
4. 点击"下载视频"按钮下载视频文件

## Gemini Veo API集成

根据Google官方文档，Veo 3是Google的先进模型，可根据文本提示生成高保真720p视频，时长为8秒，具有出色的逼真效果和原生生成的音频。

### 支持的功能

1. 文字到视频生成
2. 图片到视频生成
3. 负面提示（negativePrompt）
4. 视频参数控制（宽高比等）
5. 异步操作轮询
6. 多API密钥自动轮转

### API配置

要使用真实的视频生成功能，您需要：

1. 在 [Google AI Studio](https://aistudio.google.com/app/apikey) 获取API密钥
2. **重要：确保您的项目已启用付费功能，否则将无法使用Veo模型**
3. 将API密钥添加到 `.env` 文件中：
   ```
   # 多个密钥（逗号分隔）
   GEMINI_API_KEYS=key1,key2,key3
   ```

### 提示撰写指南

为了获得最佳效果，请在提示中包含以下元素：

- **正文**：您希望在视频中呈现的对象、人物、动物或场景
- **动作**：正文正在执行的动作
- **风格**：使用特定的电影风格关键字或动画风格
- **相机定位和运动**：如航拍、平视、俯拍等
- **构图**：如广角镜头、特写镜头等
- **对焦和镜头效果**：如浅景深、柔焦等
- **氛围**：颜色和光线对场景的贡献

### 负面提示

使用负面提示来指定您不希望在视频中出现的内容：
- 不要使用"不"或"没有"等否定词
- 直接描述您不想看到的内容，如"卡通、低质量、模糊"

## GPU加速支持

应用程序自动检测并使用可用的GPU进行视频处理加速：

- **NVIDIA GPU**：使用h264_nvenc编码器
- **Intel GPU**：使用h264_qsv编码器
- **AMD GPU**：使用h264_amf编码器
- **CPU回退**：当无GPU可用时自动使用CPU编码

## 测试

运行单元测试：
```
npm test
```

运行测试并监视文件变化：
```
npm run test:watch
```

生成测试覆盖率报告：
```
npm run test:coverage
```

## API文档

详细的API接口文档请查看 [API_DOCUMENTATION.md](API_DOCUMENTATION.md) 文件。

## 注意事项

- Gemini Veo是Google最新的视频生成模型，需要有效的付费API密钥才能使用
- 视频生成是一个计算密集型任务，可能需要几分钟时间
- 生成的视频会在服务器上存储2天，之后会被移除
- 应用程序包含完整的错误处理和用户反馈机制
- API密钥配额用完时会自动轮转到下一个可用密钥

## 未来改进

- 添加视频参数设置（更多格式、帧率等）
- 支持批量处理
- 添加用户账户系统
- 优化视频生成队列管理
- 添加生成历史记录功能
- 支持更多媒体格式
- 添加视频编辑功能
- 实现真实的视频转码功能（集成FFmpeg）
- 添加Redis缓存机制
- 添加更多的单元测试

## 许可证

MIT License